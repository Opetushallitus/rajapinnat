<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link href="bootstrap/css/bootstrap.css" rel="stylesheet" />
        <link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet" />
        <style type="text/css">
            .progress { margin-top: 20px; }
            .percent { float: left; margin-left: 5px; }
            #uploadButton { margin-top: 15px; }
        </style>

        <script src="jquery.min.js"></script>
        <script src="jquery.form.js"></script>
        <!--[if lt IE 9]>
        <script src="bootstrap/js/html5shiv.js"></script>
        <![endif]-->
        <script src="bootstrap/js/bootstrap.min.js"></script>
    </head>
    <body>
        <div class="container-fluid">
            <h1>Perusopetuksen päättöluokkalaisten perustietojen tiedonsiirto</h1>

            <ol>
                <li>Lataa <a href="perusopetusHenkiloTiedot.xml">esimerkki-perustiedot-XML -tiedosto</a>.</li>
                <li>Muokkaa tiedostoa ja lisää oppilastiedot.</li>
                <li>Lähetä tiedosto alla olevalla lomakkeella.</li>
                <li>Katsele tietoja <a href="/suoritusrekisteri/gui/index.html">suoritusrekisterin käyttöliittymästä</a>
                    (suodata henkilöllä, joka on ym esimerkki xml:ssä '111193-111V', nyt kun henkilö oid integraatiota ei vielä
                    ole).
                </li>
            </ol>

            <form id="fileupload" class="well" action="upload" method="post" enctype="multipart/form-data">
                <h3>Lähetä XML-tiedosto</h3>

                <div>
                    <input type="file" id="file" name="henkilotiedotXml[]" />
                    <span id="filename"></span>
                </div>
                <div>
                    <input type="submit" id="uploadButton" class="btn btn-success" value="Lähetä" />
                </div>

                <div class="progress progress-striped">
                    <div class="bar" style="width: 0%"></div>
                    <div class="percent">0%</div>
                </div>

                <div id="status"></div>
            </form>
        </div>

        <script type="text/javascript">
            (function() {
                var uploadButton = $("#uploadButton");
                var file = $("#file");

                uploadButton.prop("disabled", true);

                file.on("change", function(e) {
                    uploadButton.removeProp("disabled");
                    setStatus("");
                    setProgress("0%");
                });

                uploadButton.click(function() {
                    $(this).prop("disabled", true);
                });

                $("form").ajaxForm({
                    dataType: "json",
                    clearForm: true,
                    beforeSend: function(xhr, o) {
                        setStatus("");
                        setProgress("0%");
                    },
                    uploadProgress: function(event, position, total, percentComplete) {
                        setProgress(percentComplete + "%");
                    },
                    success: function(responseText, statusText, xhr, $form) {
                        setStatus(responseText.responseMessage);
                        setProgress("100%");
                    },
                    error: function() {
                        setStatus("Virhe lähetyksessä. Yritä uudelleen.");
                        setProgress("100%");
                    }
                });
            })();

            function setProgress(percentVal) {
                $(".bar").width(percentVal);
                $(".percent").text(percentVal);
            }
            function setStatus(message) {
                $("#status").hide().html(message).slideDown();
            }
        </script>
    </body>
</html>
